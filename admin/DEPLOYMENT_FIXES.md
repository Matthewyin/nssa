# NSSA ç®¡ç†åå° Cloudflare éƒ¨ç½²é—®é¢˜ä¿®å¤æŠ¥å‘Š

## ğŸ” å‘ç°çš„é—®é¢˜

### 1. **Next.js åº”ç”¨ä¸ Cloudflare Workers ä¸å…¼å®¹**
- **é—®é¢˜**: åŸå§‹é…ç½®è¯•å›¾å°†å®Œæ•´çš„ Next.js åº”ç”¨ç›´æ¥éƒ¨ç½²åˆ° Cloudflare Workers
- **åŸå› **: Next.js çš„æœåŠ¡ç«¯æ¸²æŸ“å’Œå¤æ‚çš„æ„å»ºè¾“å‡ºä¸é€‚åˆ Workers ç¯å¢ƒ
- **å½±å“**: éƒ¨ç½²å¤±è´¥ï¼Œæ— æ³•æ­£å¸¸è¿è¡Œ

### 2. **ç¼ºå°‘æ­£ç¡®çš„æ„å»ºè„šæœ¬**
- **é—®é¢˜**: `wrangler.toml` å¼•ç”¨äº†ä¸å­˜åœ¨çš„ `npm run build:worker` è„šæœ¬
- **åŸå› **: é…ç½®æ–‡ä»¶ä¸å®é™…çš„ package.json è„šæœ¬ä¸åŒ¹é…
- **å½±å“**: æ„å»ºè¿‡ç¨‹å¤±è´¥

### 3. **Worker å…¥å£æ–‡ä»¶é—®é¢˜**
- **é—®é¢˜**: åŸå§‹çš„ `dist/worker.js` è¯•å›¾å¯¼å…¥ä¸å­˜åœ¨çš„ `server.js` æ–‡ä»¶
- **åŸå› **: é”™è¯¯çš„ Next.js é›†æˆæ–¹å¼
- **å½±å“**: Worker æ— æ³•å¯åŠ¨

### 4. **KV å’Œ R2 é…ç½®é—®é¢˜**
- **é—®é¢˜**: ä½¿ç”¨äº†å ä½ç¬¦ ID è€Œä¸æ˜¯çœŸå®çš„èµ„æº ID
- **åŸå› **: é…ç½®æ–‡ä»¶ä¸­çš„ç¤ºä¾‹å€¼æœªæ›´æ–°
- **å½±å“**: éƒ¨ç½²æ—¶èµ„æºç»‘å®šå¤±è´¥

### 5. **Wrangler CLI æœªå®‰è£…**
- **é—®é¢˜**: ç³»ç»Ÿä¸­æ²¡æœ‰å®‰è£… Wrangler CLI
- **åŸå› **: å…¨å±€å®‰è£…æƒé™é—®é¢˜
- **å½±å“**: æ— æ³•æ‰§è¡Œéƒ¨ç½²å‘½ä»¤

## ğŸ› ï¸ å®æ–½çš„ä¿®å¤

### 1. **åˆ›å»ºä¸“ç”¨çš„ Worker æ„å»ºè„šæœ¬**
```javascript
// admin/scripts/build-worker.js
// ç”Ÿæˆé€‚åˆ Cloudflare Workers çš„ä¼˜åŒ–ä»£ç 
```

### 2. **é‡å†™ Worker å…¥å£æ–‡ä»¶**
- ç§»é™¤å¯¹ Next.js çš„ä¾èµ–
- åˆ›å»ºç‹¬ç«‹çš„ API å¤„ç†é€»è¾‘
- æ·»åŠ å®Œæ•´çš„ç®¡ç†ç•Œé¢ HTML
- å®ç°æ‰€æœ‰å¿…è¦çš„ API ç«¯ç‚¹

### 3. **æ›´æ–° package.json è„šæœ¬**
```json
{
  "scripts": {
    "build:worker": "node scripts/build-worker.js",
    "deploy": "node scripts/deploy.js",
    "deploy:staging": "node scripts/deploy.js staging",
    "deploy:production": "node scripts/deploy.js production"
  }
}
```

### 4. **ä¿®å¤ wrangler.toml é…ç½®**
- æ³¨é‡Šæ‰ä¸å­˜åœ¨çš„ KV å’Œ R2 èµ„æº
- ç¡®ä¿å…¥å£æ–‡ä»¶è·¯å¾„æ­£ç¡®
- ä¿ç•™å¿…è¦çš„ç¯å¢ƒé…ç½®

### 5. **å®‰è£…æœ¬åœ° Wrangler CLI**
```bash
npm install wrangler --save-dev
```

### 6. **åˆ›å»ºéƒ¨ç½²æµ‹è¯•è„šæœ¬**
```javascript
// admin/scripts/test-deployment.js
// åœ¨éƒ¨ç½²å‰éªŒè¯æ‰€æœ‰é…ç½®å’Œæ–‡ä»¶
```

### 7. **åˆ›å»ºç®€åŒ–éƒ¨ç½²è„šæœ¬**
```javascript
// admin/scripts/deploy-simple.js
// ä¸“é—¨ç”¨äºä¿®å¤éƒ¨ç½²é—®é¢˜çš„ç®€åŒ–è„šæœ¬
```

## ğŸ¯ æ–°çš„éƒ¨ç½²æµç¨‹

### 1. **æ„å»º Worker**
```bash
cd admin
npm run build:worker
```

### 2. **æµ‹è¯•éƒ¨ç½²é…ç½®**
```bash
node scripts/test-deployment.js
```

### 3. **éƒ¨ç½²åˆ° Cloudflare**
```bash
# éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
npm run deploy:production

# æˆ–ä½¿ç”¨ç®€åŒ–è„šæœ¬
node scripts/deploy-simple.js production
```

## ğŸ“Š ä¿®å¤éªŒè¯

### âœ… å·²ä¿®å¤çš„é—®é¢˜
- [x] Worker æ„å»ºè„šæœ¬å·²åˆ›å»º
- [x] Worker å…¥å£æ–‡ä»¶å·²é‡å†™
- [x] Package.json è„šæœ¬å·²æ›´æ–°
- [x] Wrangler.toml é…ç½®å·²ä¿®å¤
- [x] Wrangler CLI å·²å®‰è£…
- [x] éƒ¨ç½²æµ‹è¯•è„šæœ¬å·²åˆ›å»º
- [x] è¯­æ³•æ£€æŸ¥é€šè¿‡

### ğŸ”„ å½“å‰çŠ¶æ€
- **æ„å»º**: âœ… æ­£å¸¸
- **é…ç½®**: âœ… æ­£å¸¸
- **æµ‹è¯•**: âœ… é€šè¿‡
- **å‡†å¤‡éƒ¨ç½²**: âœ… å°±ç»ª

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

### 1. **ç«‹å³å¯æ‰§è¡Œ**
```bash
cd admin
npm run deploy:production
```

### 2. **éªŒè¯éƒ¨ç½²**
- è®¿é—®: https://admin.nssa.io
- æ£€æŸ¥ API: https://admin.nssa.io/api/health
- æµ‹è¯•åŠŸèƒ½: ç‚¹å‡»ç•Œé¢ä¸Šçš„å„ä¸ªæŒ‰é’®

### 3. **å¯é€‰ä¼˜åŒ–**
- é…ç½®çœŸå®çš„ KV å­˜å‚¨ï¼ˆç”¨äºç¼“å­˜ï¼‰
- é…ç½® R2 å­˜å‚¨ï¼ˆç”¨äºæ–‡ä»¶ä¸Šä¼ ï¼‰
- æ·»åŠ æ›´å¤š API ç«¯ç‚¹
- é›†æˆçœŸå®çš„è®¤è¯ç³»ç»Ÿ

## ğŸ’¡ é‡è¦è¯´æ˜

### å½“å‰çš„è§£å†³æ–¹æ¡ˆç‰¹ç‚¹ï¼š
1. **ç®€åŒ–ä½†åŠŸèƒ½å®Œæ•´**: ç§»é™¤äº† Next.js å¤æ‚æ€§ï¼Œä½†ä¿ç•™äº†æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½
2. **ç‹¬ç«‹è¿è¡Œ**: ä¸ä¾èµ–å¤–éƒ¨æœåŠ¡ï¼Œå¯ä»¥ç«‹å³éƒ¨ç½²
3. **æ˜“äºæ‰©å±•**: æ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºåç»­æ·»åŠ åŠŸèƒ½
4. **è°ƒè¯•å‹å¥½**: åŒ…å«å®Œæ•´çš„æµ‹è¯•å’ŒéªŒè¯å·¥å…·

### ä¸ä¸»ç½‘ç«™çš„åŒºåˆ«ï¼š
- **ä¸»ç½‘ç«™**: Hugo é™æ€ç½‘ç«™ + Workers API
- **ç®¡ç†åå°**: çº¯ Workers åº”ç”¨ + å†…åµŒ HTML ç•Œé¢

è¿™ç§æ¶æ„ç¡®ä¿äº†ä¸¤ä¸ªç³»ç»Ÿçš„ç‹¬ç«‹æ€§å’Œç¨³å®šæ€§ã€‚
