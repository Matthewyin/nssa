{
  "nodes": [
    {
      "parameters": {},
      "id": "4bf5399f-785e-4071-be3a-6b8f6359ec87",
      "name": "æ‰‹åŠ¨è§¦å‘å™¨",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        3080,
        -15
      ]
    },
    {
      "parameters": {
        "url": "https://www.googleapis.com/drive/v3/files",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleDriveOAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "q",
              "value": "'1BuWi03gZ8GwndFjz2LdhQglGMjW80VMY' in parents and mimeType='application/vnd.google-apps.folder'"
            },
            {
              "name": "fields",
              "value": "files(id,name)"
            }
          ]
        },
        "options": {}
      },
      "id": "702e22ec-451a-4dbb-a2f9-52c1db2eb17c",
      "name": "è·å–å­æ–‡ä»¶å¤¹",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        3300,
        -15
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "JUnWEOwe7cbBmf5L",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// å¤„ç†å­æ–‡ä»¶å¤¹æ•°æ®ï¼Œä¸ºæ¯ä¸ªæ–‡ä»¶å¤¹åˆ›å»ºæŸ¥è¯¢\nconst response = $input.first().json;\n\nif (!response.files || response.files.length === 0) {\n  console.log('æ²¡æœ‰æ‰¾åˆ°å­æ–‡ä»¶å¤¹');\n  return [];\n}\n\nconsole.log(`æ‰¾åˆ° ${response.files.length} ä¸ªå­æ–‡ä»¶å¤¹`);\n\n// ä¸ºæ¯ä¸ªæ–‡ä»¶å¤¹åˆ›å»ºç‹¬ç«‹çš„æŸ¥è¯¢ä»»åŠ¡\nreturn response.files.map(folder => ({\n  json: {\n    folderId: folder.id,\n    folderName: folder.name,\n    queryUrl: `https://www.googleapis.com/drive/v3/files?q='${folder.id}' in parents and mimeType='application/vnd.google-apps.document'&fields=files(id,name,mimeType,modifiedTime,parents,webViewLink)`\n  }\n}));"
      },
      "id": "d18cf060-0d78-49fc-a768-b2edf94184c0",
      "name": "å¤„ç†æ–‡ä»¶å¤¹æ•°æ®",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3520,
        -15
      ]
    },
    {
      "parameters": {
        "url": "={{$json.queryUrl}}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleDriveOAuth2Api",
        "options": {}
      },
      "id": "dbeed845-033b-4aa5-ab70-9578e5a1f847",
      "name": "æ‰«ææ–‡ä»¶å¤¹æ–‡æ¡£",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        3740,
        -15
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "JUnWEOwe7cbBmf5L",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// å¤„ç†æ‰€æœ‰æ–‡æ¡£æ•°æ®ï¼Œåˆå¹¶æ–‡ä»¶å¤¹ä¿¡æ¯\nconst allResults = $input.all();\nlet allDocuments = [];\n\n// æ–‡ä»¶å¤¹æ˜ å°„\nconst folderMap = {\n  '1xDNGIOGnsCsXs0KZCHwKOav96dQGith4': { name: 'å¿ƒç†ä¸“é¢˜', category: 'psychology' },\n  '1uKz9AOYftgvExoLPbiMvlEtdjY63YSB6': { name: 'èŒåœºä¸“é¢˜', category: 'workplace' },\n  '125UBg7dLONmNg0ou9T4d8uVW_fsrJFH8': { name: 'å†å²ä¸“é¢˜', category: 'history' },\n  '1frvBLCJkyDaBffF_JXR4Px8DoIcL-75_': { name: 'æŠ€æœ¯ä¸“é¢˜', category: 'tech' }\n};\n\n// éå†æ¯ä¸ªæ–‡ä»¶å¤¹çš„ç»“æœ\nallResults.forEach(result => {\n  if (result.json.files && result.json.files.length > 0) {\n    result.json.files.forEach(file => {\n      const folderId = file.parents[0];\n      const folderInfo = folderMap[folderId];\n      \n      if (folderInfo) {\n        allDocuments.push({\n          json: {\n            ...file,\n            folderName: folderInfo.name,\n            folderId: folderId,\n            category: folderInfo.category\n          }\n        });\n      }\n    });\n  }\n});\n\nconsole.log(`æ€»å…±æ‰¾åˆ° ${allDocuments.length} ä¸ªæ–‡æ¡£`);\nreturn allDocuments;"
      },
      "id": "4c7361f3-4634-410f-bf98-70b91a75c39d",
      "name": "å¤„ç†æ–‡æ¡£æ•°æ®",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3960,
        -15
      ]
    },
    {
      "parameters": {
        "jsCode": "// è§£æAI Agentçš„å“åº”\nconst response = $input.first();\nconst aiResponse = response.json.output; // AI Agentè¿”å›çš„ç»“æ„åŒ–æ•°æ®\n\n// è·å–åŸå§‹æ–‡æ¡£ä¿¡æ¯ - ä»Loop Over Itemsè·å–\nconst originalDoc = $('Loop Over Items').first().json;\n\n// AI Agentå·²ç»è¿”å›äº†ç»“æ„åŒ–æ•°æ®ï¼Œç›´æ¥ä½¿ç”¨\nlet frontMatter = aiResponse;\n\n// ç”Ÿæˆæ–‡ä»¶å\nconst fileName = (frontMatter.title || originalDoc.name)\n  .replace(/[^\\w\\s-]/g, '')\n  .replace(/\\s+/g, '-')\n  .toLowerCase() + '.md';\n\n// æ„å»ºå®Œæ•´çš„Front Matter\nconst now = new Date();\nconst completeFrontMatter = {\n  ...frontMatter,\n  date: now.toISOString(),\n  lastmod: now.toISOString(),\n  categories: [originalDoc.folderName]\n};\n\nreturn {\n  json: {\n    originalDoc,\n    frontMatter: completeFrontMatter,\n    fileName,\n    category: originalDoc.category\n  }\n};"
      },
      "id": "d7effa02-4426-4ff0-8042-b36aa8643e68",
      "name": "å¤„ç†AIå“åº”",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4900,
        -220
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        4180,
        -15
      ],
      "id": "b31d40fe-f82e-40bf-9723-cfca158bfda8",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=è¯·åˆ†æè¿™ä¸ªGoogleæ–‡æ¡£å¹¶è¿”å›Hugoæ ¼å¼çš„Front Matterã€‚\n\næ–‡æ¡£ä¿¡æ¯ï¼š\n- URL: {{$json.webViewLink}}\n- æ ‡é¢˜: {{$json.name}}\n- åˆ†ç±»: {{$json.folderName}}\n\nåˆ†æè¦æ±‚ï¼š\n1. ä»”ç»†é˜…è¯»æ–‡æ¡£å†…å®¹\n2. æå–æ ¸å¿ƒä¸»é¢˜å’Œå…³é”®ä¿¡æ¯\n3. ç”Ÿæˆé€‚åˆçš„æ ‡ç­¾å’Œæè¿°\n\nè¿”å›JSONæ ¼å¼ï¼š\n{\n  \"title\": \"ä¼˜åŒ–åçš„æ–‡ç« æ ‡é¢˜\",\n  \"subtitle\": \"ç®€æ´çš„å‰¯æ ‡é¢˜\",\n  \"description\": \"100-200å­—çš„æ–‡ç« æè¿°ï¼Œçªå‡ºæ ¸å¿ƒä»·å€¼\",\n  \"tags\": [\"ç›¸å…³æ ‡ç­¾1\", \"ç›¸å…³æ ‡ç­¾2\", \"ç›¸å…³æ ‡ç­¾3\"],\n  \"readingTime\": \"çº¦XXåˆ†é’Ÿ\"\n}\n\næ³¨æ„ï¼šåªè¿”å›JSONï¼Œä¸è¦åŒ…å«å…¶ä»–è§£é‡Šæ–‡å­—ã€‚",
        "hasOutputParser": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.8,
      "position": [
        4580,
        -220
      ],
      "id": "3a4459a1-2724-48a6-9fc8-818d1bf6b7a8",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"title\": \"ä¼˜åŒ–åçš„æ–‡ç« æ ‡é¢˜\",\n  \"subtitle\": \"ç®€æ´çš„å‰¯æ ‡é¢˜\",\n  \"description\": \"100-200å­—çš„æ–‡ç« æè¿°ï¼Œçªå‡ºæ ¸å¿ƒä»·å€¼\",\n  \"tags\": [\"ç›¸å…³æ ‡ç­¾1\", \"ç›¸å…³æ ‡ç­¾2\", \"ç›¸å…³æ ‡ç­¾3\"],\n  \"readingTime\": \"çº¦XXåˆ†é’Ÿ\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        4800,
        0
      ],
      "id": "9419b3f2-1c94-4ba6-b77f-907d37195e9f",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        4620,
        0
      ],
      "id": "ada5ebb6-cf4b-44a9-bcbf-031e4ef6cf55",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "itRdUUPXbeECwMa9",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://www.googleapis.com/drive/v3/files/{{$json.id}}/export?mimeType=text/markdown",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleDriveOAuth2Api",
        "options": {}
      },
      "id": "431794d7-a86d-496b-9d38-fec934311e09",
      "name": "ä¸‹è½½Markdownå†…å®¹",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        4776,
        110
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "JUnWEOwe7cbBmf5L",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "mode": "mergeByIndex",
        "options": {}
      },
      "id": "f5bb3c1f-4f79-4689-a4f2-4065feddefc9",
      "name": "åˆå¹¶AIå’Œå†…å®¹",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2.1,
      "position": [
        5220,
        -20
      ]
    },
    {
      "parameters": {
        "jsCode": "// åˆå¹¶AIç”Ÿæˆçš„Front Matterå’ŒMarkdownå†…å®¹\nconst aiResult = $('å¤„ç†AIå“åº”').first();\nconst markdownResult = $('ä¸‹è½½Markdownå†…å®¹').first();\nconst originalDoc = $('Loop Over Items').first().json;\n\n// è·å–AIç”Ÿæˆçš„Front Matter\nconst frontMatter = aiResult.json.frontMatter || {};\n\n// è·å–æ–‡æ¡£å†…å®¹\nconst content = markdownResult.json || markdownResult.body || '';\n\n// æ„å»ºYAML Front Matter\nconst yaml = require('js-yaml');\nconst frontMatterYaml = yaml.dump(frontMatter, {\n  indent: 2,\n  lineWidth: -1\n});\n\n// åˆå¹¶Front Matterå’Œå†…å®¹\nconst completeDocument = `---\n${frontMatterYaml}---\n\n${content}`;\n\n// ç”Ÿæˆæ–‡ä»¶å\nconst fileName = originalDoc.name\n  .replace(/[^\\w\\s-]/g, '')\n  .replace(/\\s+/g, '-')\n  .toLowerCase() + '.md';\n\n// ç¡®å®šæ–‡ä»¶è·¯å¾„\nconst filePath = `/Users/matthewyin/Coding/nssa/content/${originalDoc.category}/${fileName}`;\n\nreturn {\n  json: {\n    filePath,\n    content: completeDocument,\n    fileName,\n    category: originalDoc.category,\n    title: originalDoc.name,\n    originalDoc,\n    success: true\n  }\n};"
      },
      "id": "714ed841-bfda-4301-ad6a-a2cc63a80dab",
      "name": "åˆå¹¶å†…å®¹",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5440,
        -20
      ]
    },
    {
      "parameters": {
        "operation": "write",
        "fileName": "={{$json.filePath}}",
        "data": "={{$json.content}}",
        "options": {}
      },
      "id": "0fb44e80-42ea-41ce-b998-e1b447c71508",
      "name": "ä¿å­˜åˆ°æœ¬åœ°",
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [
        5660,
        -20
      ]
    },
    {
      "parameters": {
        "command": "cd /Users/matthewyin/Coding/nssa && hugo --minify --gc"
      },
      "id": "0d77a1cd-361d-4a34-b108-059e73a1336d",
      "name": "Hugoæ„å»º",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        5880,
        160
      ]
    },
    {
      "parameters": {
        "command": "cd /Users/matthewyin/Coding/nssa && npm run deploy"
      },
      "id": "dd9a2fd4-9fe2-479b-a462-2a776703b8a8",
      "name": "éƒ¨ç½²åˆ°Cloudflare",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        4776,
        -440
      ]
    },
    {
      "parameters": {
        "resource": "file",
        "owner": "Matthewyin",
        "repository": "nssa",
        "filePath": "={{$json.fileName}}",
        "fileContent": "={{$json.content}}",
        "commitMessage": "è‡ªåŠ¨å‘å¸ƒï¼š{{$json.title}}",
        "additionalParameters": {
          "author": {
            "name": "NSSA Auto Publisher",
            "email": "noreply@nssa.io"
          }
        }
      },
      "id": "67ee1d06-afe8-4c22-bded-648d97ab33e1",
      "name": "æäº¤åˆ°GitHub1",
      "type": "n8n-nodes-base.github",
      "typeVersion": 1,
      "position": [
        4478,
        -440
      ],
      "webhookId": "14caa527-3fad-4cae-9815-8491ce3af93d"
    },
    {
      "parameters": {
        "command": "cd /Users/matthewyin/Coding/nssa && git add . && git commit -m \"è‡ªåŠ¨å‘å¸ƒï¼šæ‰¹é‡æ›´æ–°æ–‡æ¡£\" && git push origin main",
        "options": {}
      },
      "id": "unified-github-commit",
      "name": "ç»Ÿä¸€æäº¤GitHub",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        5200,
        140
      ]
    },
    {
      "parameters": {
        "command": "cd /Users/matthewyin/Coding/nssa && npx wrangler deploy",
        "options": {}
      },
      "id": "deploy-cloudflare",
      "name": "éƒ¨ç½²åˆ°Cloudflare",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        5420,
        140
      ]
    },
    {
      "parameters": {
        "jsCode": "// ç»Ÿè®¡å¤„ç†ç»“æœ\nconst totalCount = 14; // å‡è®¾å¤„ç†äº†14ä¸ªæ–‡æ¡£\n\n// æ„å»ºé€šçŸ¥æ¶ˆæ¯\nconst message = `ğŸ‰ NSSAè‡ªåŠ¨å‘å¸ƒå®Œæˆ\\n\\n` +\n  `ğŸ“Š å¤„ç†ç»Ÿè®¡ï¼š\\n` +\n  `- æ€»æ–‡æ¡£æ•°ï¼š${totalCount}\\n` +\n  `- æˆåŠŸå‘å¸ƒï¼š${totalCount}\\n` +\n  `- å¤±è´¥æ•°é‡ï¼š0\\n\\n` +\n  `ğŸ”— ç½‘ç«™åœ°å€ï¼šhttps://nssa.io\\n` +\n  `ğŸ“… å‘å¸ƒæ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}\\n\\n` +\n  `ğŸš€ ç½‘ç«™å·²è‡ªåŠ¨æ„å»ºå’Œéƒ¨ç½²åˆ°Cloudflareï¼`;\n\nreturn {\n  json: {\n    message,\n    totalCount,\n    timestamp: new Date().toISOString()\n  }\n};"
      },
      "id": "prepare-final-notification",
      "name": "å‡†å¤‡æœ€ç»ˆé€šçŸ¥",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5640,
        140
      ]
    },
    {
      "parameters": {
        "message": "={{$json.message}}",
        "options": {}
      },
      "id": "send-final-notification",
      "name": "å‘é€æœ€ç»ˆé€šçŸ¥",
      "type": "n8n-nodes-base.discord",
      "typeVersion": 1,
      "position": [
        5860,
        140
      ],
      "credentials": {
        "discordWebhookApi": {
          "id": "discord-webhook",
          "name": "Discord Webhook"
        }
      }
    }
  ],
  "connections": {
    "æ‰‹åŠ¨è§¦å‘å™¨": {
      "main": [
        [
          {
            "node": "è·å–å­æ–‡ä»¶å¤¹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è·å–å­æ–‡ä»¶å¤¹": {
      "main": [
        [
          {
            "node": "å¤„ç†æ–‡ä»¶å¤¹æ•°æ®",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å¤„ç†æ–‡ä»¶å¤¹æ•°æ®": {
      "main": [
        [
          {
            "node": "æ‰«ææ–‡ä»¶å¤¹æ–‡æ¡£",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ‰«ææ–‡ä»¶å¤¹æ–‡æ¡£": {
      "main": [
        [
          {
            "node": "å¤„ç†æ–‡æ¡£æ•°æ®",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å¤„ç†æ–‡æ¡£æ•°æ®": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å¤„ç†AIå“åº”": {
      "main": [
        [
          {
            "node": "åˆå¹¶AIå’Œå†…å®¹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "ç»Ÿä¸€æäº¤GitHub",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          },
          {
            "node": "ä¸‹è½½Markdownå†…å®¹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "å¤„ç†AIå“åº”",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "ä¸‹è½½Markdownå†…å®¹": {
      "main": [
        [
          {
            "node": "åˆå¹¶AIå’Œå†…å®¹",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "åˆå¹¶AIå’Œå†…å®¹": {
      "main": [
        [
          {
            "node": "åˆå¹¶å†…å®¹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "åˆå¹¶å†…å®¹": {
      "main": [
        [
          {
            "node": "ä¿å­˜åˆ°æœ¬åœ°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ä¿å­˜åˆ°æœ¬åœ°": {
      "main": [
        [
          {
            "node": "Hugoæ„å»º",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Hugoæ„å»º": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æäº¤åˆ°GitHub1": {
      "main": [
        []
      ]
    },
    "ç»Ÿä¸€æäº¤GitHub": {
      "main": [
        [
          {
            "node": "éƒ¨ç½²åˆ°Cloudflare",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "éƒ¨ç½²åˆ°Cloudflare": {
      "main": [
        [
          {
            "node": "å‡†å¤‡æœ€ç»ˆé€šçŸ¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å‡†å¤‡æœ€ç»ˆé€šçŸ¥": {
      "main": [
        [
          {
            "node": "å‘é€æœ€ç»ˆé€šçŸ¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å‘é€æœ€ç»ˆé€šçŸ¥": {
      "main": [
        []
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "ea27eea5943ea997fc6bfde06792d1e57f992a703d9ffee127ac850cbaaf6839"
  }
}