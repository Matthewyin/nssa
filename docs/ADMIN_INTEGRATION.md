# NSSA Admin é›†æˆéƒ¨ç½²æŒ‡å—

## ğŸ¯ é›†æˆæ–¹æ¡ˆæ¦‚è¿°

å°†NSSAç®¡ç†åå°ä¸ä¸»ç«™åˆå¹¶åˆ°åŒä¸€ä¸ªCloudflare Workerä¸­ï¼Œé€šè¿‡åŸŸåè·¯ç”±å®ç°åŠŸèƒ½åˆ†ç¦»ã€‚

### æ¶æ„ä¼˜åŠ¿
- âœ… **ç®€åŒ–éƒ¨ç½²**: å•ä¸€Workerï¼Œç»Ÿä¸€ç®¡ç†
- âœ… **èµ„æºå…±äº«**: å…±äº«KVå­˜å‚¨å’ŒAPIé€»è¾‘
- âœ… **æ€§èƒ½ä¼˜åŒ–**: å‡å°‘å†·å¯åŠ¨ï¼Œæé«˜å“åº”é€Ÿåº¦
- âœ… **æˆæœ¬èŠ‚çº¦**: å‡å°‘Workeræ•°é‡ï¼Œé™ä½è´¹ç”¨
- âœ… **ç»´æŠ¤ä¾¿åˆ©**: ç»Ÿä¸€çš„ä»£ç åº“å’Œéƒ¨ç½²æµç¨‹

## ğŸŒ åŸŸåé…ç½®

### è·¯ç”±è§„åˆ™
```
nssa.io/*         â†’ ä¸»ç«™ (Hugoé™æ€ç½‘ç«™)
www.nssa.io/*     â†’ ä¸»ç«™ (é‡å®šå‘åˆ°ä¸»åŸŸå)
admin.nssa.io/*   â†’ ç®¡ç†åå° (Adminç•Œé¢)
```

### DNSè®°å½•é…ç½®
åœ¨Cloudflare DNSä¸­æ·»åŠ ä»¥ä¸‹è®°å½•ï¼š

```
ç±»å‹    åç§°     å†…å®¹                ä»£ç†çŠ¶æ€
A       @        192.0.2.1          å·²ä»£ç† ğŸ§¡
A       www      192.0.2.1          å·²ä»£ç† ğŸ§¡
A       admin    192.0.2.1          å·²ä»£ç† ğŸ§¡
```

> æ³¨æ„ï¼šIPåœ°å€å¯ä»¥æ˜¯ä»»æ„å€¼ï¼Œå› ä¸ºCloudflare Workersä¼šæ‹¦æˆªæ‰€æœ‰è¯·æ±‚

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. Workerè·¯ç”±é€»è¾‘
```javascript
async function handleEvent(event) {
  const url = new URL(event.request.url)
  
  // æ£€æŸ¥æ˜¯å¦æ˜¯adminåŸŸåè®¿é—®
  if (url.hostname === 'admin.nssa.io') {
    return handleAdminRequest(event.request, url)
  }
  
  // å¤„ç†ä¸»ç«™è¯·æ±‚
  return handleMainSiteRequest(event.request, url)
}
```

### 2. AdminåŠŸèƒ½æ¨¡å—
- ğŸ” **è®¤è¯ç³»ç»Ÿ**: ç™»å½•/ç™»å‡º/ç”¨æˆ·ç®¡ç†
- ğŸ“Š **åˆ†ææ•°æ®**: æ–‡ç« ç»Ÿè®¡ã€è®¿é—®åˆ†æ
- ğŸ“ **å†…å®¹ç®¡ç†**: æ–‡ç« åˆ—è¡¨ã€çŠ¶æ€ç®¡ç†
- âš™ï¸ **ç³»ç»Ÿç®¡ç†**: å¥åº·æ£€æŸ¥ã€é…ç½®ä¿¡æ¯
- ğŸ“ **æ–‡ä»¶ä¸Šä¼ **: åª’ä½“èµ„æºç®¡ç†

### 3. APIç«¯ç‚¹
```
ä¸»ç«™API:
  /api/views/*      - PVç»Ÿè®¡
  /api/likes/*      - ç‚¹èµåŠŸèƒ½

Admin API:
  /api/health       - å¥åº·æ£€æŸ¥
  /api/auth/*       - è®¤è¯ç›¸å…³
  /api/articles     - æ–‡ç« ç®¡ç†
  /api/analytics    - åˆ†ææ•°æ®
  /api/system/*     - ç³»ç»Ÿç®¡ç†
  /api/upload       - æ–‡ä»¶ä¸Šä¼ 
```

## ğŸš€ éƒ¨ç½²æµç¨‹

### 1. å‡†å¤‡å·¥ä½œ
```bash
# ç¡®ä¿Hugoç½‘ç«™å·²æ„å»º
npm run build

# æ£€æŸ¥Workerä»£ç 
node -c workers-site/index.js
```

### 2. æ‰§è¡Œé›†æˆéƒ¨ç½²
```bash
# å®Œæ•´éƒ¨ç½²ï¼ˆåŒ…å«Hugoæ„å»ºï¼‰
npm run deploy:integrated

# è·³è¿‡Hugoæ„å»ºï¼ˆä»…éƒ¨ç½²Workerï¼‰
npm run deploy:integrated:skip-build

# éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
npm run deploy:integrated:staging
```

### 3. éªŒè¯éƒ¨ç½²
è®¿é—®ä»¥ä¸‹URLç¡®è®¤åŠŸèƒ½æ­£å¸¸ï¼š

- **ä¸»ç«™**: https://nssa.io
- **ç®¡ç†åå°**: https://admin.nssa.io
- **å¥åº·æ£€æŸ¥**: https://admin.nssa.io/api/health

## ğŸ” åŠŸèƒ½æµ‹è¯•

### ä¸»ç«™åŠŸèƒ½æµ‹è¯•
```bash
# æµ‹è¯•PVç»Ÿè®¡API
curl "https://nssa.io/api/views/get?path=/workplace/sic"

# æµ‹è¯•ç‚¹èµAPI
curl -X POST "https://nssa.io/api/likes/toggle" \
  -H "Content-Type: application/json" \
  -d '{"path":"/workplace/sic","clientId":"test-client"}'
```

### AdminåŠŸèƒ½æµ‹è¯•
```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl "https://admin.nssa.io/api/health"

# æµ‹è¯•åˆ†ææ•°æ®
curl "https://admin.nssa.io/api/analytics"

# æµ‹è¯•æ–‡ç« ç®¡ç†
curl "https://admin.nssa.io/api/articles"
```

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### 1. æ—¥å¿—æŸ¥çœ‹
```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
npx wrangler tail

# æŸ¥çœ‹ç‰¹å®šæ—¶é—´æ®µçš„æ—¥å¿—
npx wrangler tail --since 1h
```

### 2. æ€§èƒ½ç›‘æ§
- åœ¨Cloudflare Dashboardä¸­æŸ¥çœ‹Workeråˆ†æ
- ç›‘æ§è¯·æ±‚é‡ã€é”™è¯¯ç‡ã€å“åº”æ—¶é—´
- è®¾ç½®å‘Šè­¦è§„åˆ™

### 3. æ•…éšœæ’é™¤
å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼š

**é—®é¢˜**: admin.nssa.io æ— æ³•è®¿é—®
**è§£å†³**: æ£€æŸ¥DNSè®°å½•å’ŒWorkerè·¯ç”±é…ç½®

**é—®é¢˜**: APIè¿”å›404é”™è¯¯
**è§£å†³**: ç¡®è®¤Workerä»£ç ä¸­åŒ…å«å¯¹åº”çš„APIå¤„ç†å‡½æ•°

**é—®é¢˜**: è·¨åŸŸè¯·æ±‚å¤±è´¥
**è§£å†³**: æ£€æŸ¥CORSå¤´éƒ¨è®¾ç½®

## ğŸ”„ å›æ»šæ–¹æ¡ˆ

å¦‚æœé›†æˆéƒ¨ç½²å‡ºç°é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿå›æ»šï¼š

### 1. æ¢å¤ç‹¬ç«‹éƒ¨ç½²
```bash
# éƒ¨ç½²åŸå§‹çš„ä¸»ç«™Worker
git checkout HEAD~1 -- workers-site/index.js
npm run deploy

# å•ç‹¬éƒ¨ç½²Admin Worker
cd admin
npm run deploy:production
```

### 2. ä¿®æ”¹DNSè®°å½•
å°†admin.nssa.ioæŒ‡å‘ç‹¬ç«‹çš„Admin Worker

## ğŸ“ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„AdminåŠŸèƒ½
1. åœ¨`handleAdminApiRequest`ä¸­æ·»åŠ æ–°çš„è·¯ç”±
2. å®ç°å¯¹åº”çš„å¤„ç†å‡½æ•°
3. åœ¨Admin HTMLç•Œé¢ä¸­æ·»åŠ è°ƒç”¨æŒ‰é’®
4. æµ‹è¯•åŠŸèƒ½å¹¶éƒ¨ç½²

### ä¿®æ”¹ä¸»ç«™åŠŸèƒ½
1. ä¿æŒç°æœ‰APIå…¼å®¹æ€§
2. åœ¨`handleApiRequest`ä¸­ä¿®æ”¹é€»è¾‘
3. ç¡®ä¿ä¸å½±å“AdminåŠŸèƒ½
4. è¿›è¡Œå®Œæ•´æµ‹è¯•

## ğŸ‰ æ€»ç»“

é€šè¿‡å°†AdminåŠŸèƒ½é›†æˆåˆ°ä¸»ç«™Workerä¸­ï¼Œæˆ‘ä»¬å®ç°äº†ï¼š

- ğŸ—ï¸ **ç»Ÿä¸€æ¶æ„**: å•ä¸€Workerå¤„ç†æ‰€æœ‰è¯·æ±‚
- ğŸŒ **åŸŸååˆ†ç¦»**: é€šè¿‡åŸŸååŒºåˆ†ä¸»ç«™å’Œç®¡ç†åå°
- ğŸ“ˆ **æ€§èƒ½æå‡**: å…±äº«èµ„æºï¼Œå‡å°‘å†·å¯åŠ¨
- ğŸ’° **æˆæœ¬ä¼˜åŒ–**: å‡å°‘Workeræ•°é‡å’Œå¤æ‚æ€§
- ğŸ”§ **ç»´æŠ¤ç®€åŒ–**: ç»Ÿä¸€çš„éƒ¨ç½²å’Œç›‘æ§æµç¨‹

è¿™ç§é›†æˆæ–¹æ¡ˆç‰¹åˆ«é€‚åˆä¸­å°å‹é¡¹ç›®ï¼Œåœ¨ä¿æŒåŠŸèƒ½å®Œæ•´æ€§çš„åŒæ—¶ï¼Œå¤§å¤§ç®€åŒ–äº†éƒ¨ç½²å’Œç»´æŠ¤çš„å¤æ‚åº¦ã€‚
